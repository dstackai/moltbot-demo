type: service
name: moltbot

env:
  - MODEL_BASE_URL
  - DSTACK_TOKEN

commands:
  # System dependencies
  - sudo apt update
  - sudo apt install -y ca-certificates curl gnupg

  # Node.js & moltbot installation
  - curl -fsSL https://deb.nodesource.com/setup_24.x | sudo -E bash -
  - sudo apt install -y nodejs
  - curl -fsSL https://molt.bot/install.sh | bash -s -- --no-onboard

  # Model configuration
  - |
    clawdbot config set models.providers.custom '{
      "baseUrl": "'"$MODEL_BASE_URL"'",
      "apiKey": "'"$DSTACK_TOKEN"'",
      "api": "openai-completions",
      "models": [
        {
          "id": "deepseek-ai/DeepSeek-R1-Distill-Qwen-32B",
          "name": "DeepSeek-R1-Distill-Qwen-32B",
          "reasoning": true,
          "input": ["text"],
          "cost": {"input": 0, "output": 0, "cacheRead": 0, "cacheWrite": 0},
          "contextWindow": 128000,
          "maxTokens": 512
        }
      ]
    }' --json

  # Set active model & gateway settings
  - clawdbot models set custom/deepseek-ai/DeepSeek-R1-Distill-Qwen-32B
  - clawdbot config set gateway.mode local
  - clawdbot config set gateway.auth.mode token
  - clawdbot config set gateway.auth.token "$DSTACK_TOKEN"
  - clawdbot config set gateway.controlUi.allowInsecureAuth true
  - clawdbot config set gateway.trustedProxies '["127.0.0.1"]'

  # Start service
  - clawdbot gateway

port: 18789
auth: false

resources:
  cpu: 2
